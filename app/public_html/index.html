<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Searchify</title>
	<script src="https://d3js.org/d3.v6.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>
	<div>
	</div>
    <div>
        <h1 class="header">Searchify</h1>
        <br>
        <hr class="rounded">
        <h3 class="sub-header">An interactive way to expand your taste in music.</h3>
        <br>
        <input class = "search" type="text" placeholder="Search for an artist...">
    </div>
    <br>
    <!-- Delete all code below this until the next comment, this is just Chance's testing-->
    <img id = "artistPic" src="" alt="Image of Searched Artist" style="width:400px;height:300;"></img>
    <br>
    <div id = "artist">
                <label for="artist"></label>
            </div>
    <div id = "followers">
                <label for="followers"></label>
            </div>
    <div id = "genre">
                <label for="genre"></label>
            </div>
    <div id = "uri">
                <label for="uri"></label>
            </div>
    <!-- Delete all code above this until the next comment, this is just Chance's testing-->
    <div id="chart">
		</div>
<script>
/*let p = d3.select("body").selectAll("p")
	.data(dataset)
	.enter()
	.append("p")
	.text(function(d) {return d;});
let svg = d3.select("body").append("svg");
	*/
let search_field = document.querySelector("input");

search_field.addEventListener("keyup", function(event){
    if (event.keyCode === 13) {
        let search_value = search_field.value;
        event.preventDefault();

        console.log(search_value);
        console.log("made it into the eventListener");
        // https://api.spotify.com/v1/search?q=tania%20bowra&type=artist
        let fetchURL = '/search?artist=' + search_value;
        fetch(fetchURL).then(function (response) {
            console.log(response.status);
            if (response.status === 200){
                return response.json();
            } else {
                console.log("error");
            }
        /*fetch(`/search?artist=${search_value}`, {
        method: "POST",
        headers: {
        "Content-Type": "application/json"
        },
        body: JSON.stringify({search_value}),*/
        }).then(function (response) {
            // comment out code below until next comment, this was used for Chance's testing
            let artistDiv = document.getElementById("artist");
            artistDiv.textContent = "Artist Name: " + response.name;
            let followersDiv = document.getElementById("followers");
            followersDiv.textContent = "Followers: " + response.followers;
            let genreDiv = document.getElementById("genre");
            genreDiv.textContent = "Genre: " + response.genre;
            let artistImage = document.getElementById("artistPic");
            artistImage.src = response.imageURL;
            let uriDiv = document.getElementById("uri");
            uriDiv.textContent = "Spotify URI: " + response.uri;
            let artistURI = response.uri;
            // comment out code above until next comment
            console.log(response);
            //console.log(response.status);
            relatedFunction(artistURI);
        }).catch(function (error) {
            console.log(error);
        });
        
        
        //beginning of related artists fetch
        function relatedFunction(artistURI){
            console.log(artistURI);
        let fetchURL = '/related?uri=' + artistURI;
        fetch(fetchURL).then(function (response) {
            console.log(response.status);
            if (response.status === 200){
                return response.json();
            } else {
                console.log("error");
            }
        }).then(function (response) {
            
            console.log(response);

            /* some sort of for loop here to generate the circles w the necessary data, use the variables below for correct naming conventions
             
            the following variables access the response json:
             
            let artist = response[i].name;
            let followers = response[i].followers;
            let genre = response[i].genre;
            let imageURL = response[i].imageURL;
            let URI = response[i].uri;
            */
            
            for (let i = 0; i < 20; i++){
                console.log(response[i].name);
            }
            
        }).catch(function (error) {
            console.log(error);
        });}
        
    }
});

/* field's needed
Photo
Genre:
Most Popular Release:
Followers:
Monthly Listeners:
Most Similar To:
*/

</script>
</body>
</html>
